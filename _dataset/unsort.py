import argparse
import glob
import os
import shutil

from tqdm import tqdm

DEFAULT_UNSORTED_DATASET_FOLDER = "_dataset/unsorted_dataset"
DEFAULT_SORTED_DATASET_FOLDER = "_dataset/sorted_dataset"

def parse_args():
    parser = argparse.ArgumentParser(description="Move APKs to unsorted state")
    
    parser.add_argument(
        "--unsorted_dataset",
        type=str,
        default=DEFAULT_UNSORTED_DATASET_FOLDER,
        help="The root directory of the unsorted dataset.",
    )
    
    parser.add_argument(
        "--sorted_dataset",
        type=str,
        default=DEFAULT_SORTED_DATASET_FOLDER, 
        help="The root directory of the sorted dataset.",
    )
    
    return parser.parse_args()


if __name__ == "__main__":
    args = parse_args()

    UNSORTED_DATASET_DIRECTORY = args.unsorted_dataset
    SORTED_DATASET_DIRECTORY = args.sorted_dataset

    apks_paths = glob.glob(f"{SORTED_DATASET_DIRECTORY}/**/*.apk", recursive=True)

    os.makedirs(UNSORTED_DATASET_DIRECTORY, exist_ok=True)

    for apk in tqdm(apks_paths, desc="Moving APKs to unsorted state..."):
        shutil.move(apk, f"{UNSORTED_DATASET_DIRECTORY}/{os.path.basename(apk)}")
